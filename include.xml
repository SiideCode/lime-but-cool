<?xml version="1.0" encoding="utf-8"?>
<extension>

	<log error="Lime ${lime} is not compatible with Haxe ${haxe} (version 3.2.0 or higher is required)" if="${haxe < 3.2.0}" />

	<log error="Lime ${lime} requires Haxe 4 to target HashLink (version ${haxe} found)" if="hl ${${haxe} < 4.0}" />

	<set name="lime" />

	<define name="native" if="cpp || neko || cs || java || hl" />

	<define name="lime-cairo" if="native" />
	<define name="lime-cffi" if="native" />
	<define name="lime-curl" unless="lime-console || lime-switch" />
	<define name="lime-harfbuzz" if="native" />
	<define name="lime-native" if="native" />
	<define name="lime-openal" unless="lime-console" />
	<define name="lime-opengl" if="desktop" />
	<define name="lime-opengles" if="mobile" />
	<define name="lime-vorbis" if="native" />

	<define name="no-typedarray-inline" if="cs" />
	<haxedef name="no-compilation" />

	<templatePath name="templates" />
	<sample path="samples" unless="openfl" />

	<haxelib name="format" if="java" />

	<target name="ps3" handler="lime-ps3" />
	<haxelib name="lime-ps3" if="ps3" />

	<target name="ps4" handler="lime-ps4" />
	<haxelib name="lime-ps4" if="ps4" />

	<target name="vita" handler="lime-vita" />
	<haxelib name="lime-vita" if="vita" />

	<target name="switch" handler="lime-switch" />
	<haxelib name="lime-switch" if="switch" />

	<target name="wiiu" handler="lime-wiiu" />
	<haxelib name="lime-wiiu" if="wiiu" />

	<target name="xbox1" handler="lime-xbox1" />
	<haxelib name="lime-xbox1" if="xbox1" />

	<target name="console-pc" handler="lime-console-pc" />
	<haxelib name="lime-console-pc" if="console-pc" />

	<section if="hxp" unless="lime-tools">

		<target name="android" path="tools/platforms/AndroidPlatform.hx" />
		<target name="ios" path="tools/platforms/IOSPlatform.hx" />
		<target name="linux" path="tools/platforms/LinuxPlatform.hx" />
		<target name="mac" path="tools/platforms/MacPlatform.hx" />
		<target name="tvos" path="tools/platforms/TVOSPlatform.hx" />
		<target name="windows" path="tools/platforms/WindowsPlatform.hx" />

	</section>

	<section unless="display">

		<section if="cpp ${${haxe_ver} < 3.3}" unless="static_link">
			<ndll name="std" haxelib="hxcpp" />
			<ndll name="regexp" haxelib="hxcpp" />
			<ndll name="zlib" haxelib="hxcpp" unless="ios || tvos" />
		</section>

		<ndll name="lime" if="native" unless="lime-console static_link || lime-switch static_link" />

		<dependency name="extension-api" path="dependencies/extension-api" if="android" />
		<dependency path="dependencies/angle/d3dcompiler_47.dll" if="windows angle" unless="static_link" />
		<dependency path="dependencies/angle/libegl.dll" if="windows angle" unless="static_link" />
		<dependency path="dependencies/angle/libglesv2.dll" if="windows angle" unless="static_link" />

		<!-- TODO: Move to template or move all template dependencies to XML? -->
		<!-- <dependency name="CoreBluetooth.framework" if="ios" /> -->

		<define name="MACOSX_DEPLOYMENT_TARGET" value="10.9" if="mac" unless="MACOSX_DEPLOYMENT_TARGET" />
		<setenv name="MACOSX_DEPLOYMENT_TARGET" value="${MACOSX_DEPLOYMENT_TARGET}" if="mac" />

		<architecture name="armv7" if="android" />

		<section if="lime-modular">

			<set name="haxe-module-name" value="haxe" unless="haxe-module-name" />
			<set name="lime-module-name" value="lime" unless="lime-module-name" />
			<setenv name="HAXE_STD_PATH" value="${HAXE_STD_PATH}" if="HAXE_STD_PATH" />

		</section>

	</section>

	<haxelib name="hxcpp" if="setup" />
	<haxelib name="lime-samples" if="setup" />

	<include haxelib="lime-samples" if="create" />

	<section if="rebuild">

		<config:project>
			<rebuild fulldebug="true" />
		</config:project>

	</section>

</extension>